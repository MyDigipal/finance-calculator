<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulateur de Management SEO | MyDigipal</title>
  <meta name="description" content="Composez votre offre SEO sur-mesure avec MyDigipal. Calculateur interactif pour estimer votre accompagnement r√©f√©rencement.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .disabled-section { opacity: 0.5; filter: grayscale(0.8); }
    .disabled-section .level-card { pointer-events: none; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Ic√¥nes SVG inline
    const CheckIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20,6 9,17 4,12"></polyline>
      </svg>
    );

    const ChevronRightIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="9,18 15,12 9,6"></polyline>
      </svg>
    );

    const ChevronDownIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6,9 12,15 18,9"></polyline>
      </svg>
    );

    const SparklesIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 3l1.912 5.813a2 2 0 001.275 1.275L21 12l-5.813 1.912a2 2 0 00-1.275 1.275L12 21l-1.912-5.813a2 2 0 00-1.275-1.275L3 12l5.813-1.912a2 2 0 001.275-1.275L12 3z"></path>
      </svg>
    );

    const InfoIcon = () => (
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
    );

    const MailIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="2" y="4" width="20" height="16" rx="2"></rect>
        <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
      </svg>
    );

    const ArrowRightIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="5" y1="12" x2="19" y2="12"></line>
        <polyline points="12,5 19,12 12,19"></polyline>
      </svg>
    );

    const XIcon = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const LoaderIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
      </svg>
    );

    // Donn√©es des services avec descriptions d√©taill√©es
    const services = [
      {
        id: 'audit',
        title: 'A. Audit & Strat√©gie SEO',
        description: 'La base de toute strat√©gie SEO efficace. Nous analysons votre site, votre march√© et vos concurrents pour d√©finir un plan d\'action adapt√© √† vos objectifs.',
        icon: 'üîç',
        detailedInfo: {
          title: 'Audit & Strat√©gie SEO - En d√©tail',
          content: `Notre audit SEO comprend une analyse technique compl√®te de votre site, une √©tude approfondie des mots-cl√©s de votre secteur, et un benchmark de vos concurrents.

**Ce que nous analysons :**
‚Ä¢ Vitesse de chargement (Core Web Vitals)
‚Ä¢ Structure des URLs et architecture du site
‚Ä¢ M√©tadonn√©es (titres, descriptions, balises H1-H6)
‚Ä¢ Maillage interne entre les pages
‚Ä¢ Compatibilit√© mobile et responsive design
‚Ä¢ Erreurs 404, redirections, liens cass√©s
‚Ä¢ Indexation et fichier sitemap.xml

**Strat√©gie de Mots-Cl√©s :**
Nous organisons les mots-cl√©s en clusters th√©matiques pour √©viter la cannibalisation SEO et concentrer les efforts de fa√ßon strat√©gique.

**Livrable :** Roadmap SEO personnalis√©e avec priorisation des actions et KPIs de suivi.`
        },
        levels: [
          { name: 'Essentiel', price: 200, features: ['Audit technique basique', '10-15 mots-cl√©s principaux', 'Recommandations g√©n√©rales'], recommended: 'Sites r√©cents ou petits budgets', color: 'blue' },
          { name: 'Avanc√©', price: 350, features: ['Audit approfondi', 'Clusters th√©matiques', 'Priorisation des actions', 'Roadmap trimestrielle'], recommended: 'Sites √©tablis cherchant √† cro√Ætre', color: 'indigo', popular: true },
          { name: 'Premium', price: 500, features: ['Audit complet', 'Benchmark concurrence', 'Strat√©gie 6 mois', 'R√©visions mensuelles'], recommended: 'March√©s concurrentiels', color: 'purple' }
        ]
      },
      {
        id: 'corrections',
        title: 'B. Corrections Techniques',
        description: 'Un site techniquement sain est la fondation d\'un bon r√©f√©rencement. Nous identifions et corrigeons les freins techniques.',
        icon: 'üîß',
        detailedInfo: {
          title: 'Corrections Techniques - En d√©tail',
          content: `Un site techniquement sain est la fondation d'un bon r√©f√©rencement. Nous utilisons des outils professionnels (Ahrefs, Screaming Frog) pour d√©tecter tous les probl√®mes.

**Types d'erreurs d√©tect√©es :**
‚Ä¢ Erreurs 404 et liens cass√©s
‚Ä¢ Probl√®mes de redirections (cha√Ænes, boucles)
‚Ä¢ Contenu dupliqu√©
‚Ä¢ Probl√®mes de canonicals
‚Ä¢ Erreurs de balisage Schema.org
‚Ä¢ Probl√®mes d'indexation (noindex accidentels)
‚Ä¢ Vitesse de chargement lente

**Nettoyage des backlinks toxiques :**
Nous analysons votre profil de liens et d√©savouons les backlinks spam via Google Search Console pour √©viter les p√©nalit√©s.

**Livrable :** Rapport technique avec priorisation High/Medium/Low et guide d'impl√©mentation.`
        },
        levels: [
          { name: 'Essentiel', price: 100, features: ['Liste des erreurs d√©tect√©es', 'Export brut des probl√®mes'], recommended: 'Webmaster en interne', color: 'blue' },
          { name: 'Avanc√©', price: 250, features: ['D√©tection des erreurs', 'Explications d√©taill√©es', 'Recommandations actionnables'], recommended: 'Comprendre et prioriser', color: 'indigo', popular: true },
          { name: 'Premium', price: 500, priceNote: '400-600‚Ç¨', features: ['D√©tection compl√®te', 'Impl√©mentation par MyDigipal', 'Suivi des corrections'], recommended: 'On s\'en occupe pour vous', color: 'purple' }
        ]
      },
      {
        id: 'pages',
        title: 'C. Optimisation Pages Centrales',
        description: 'Vos pages cl√©s m√©ritent une attention particuli√®re. Nous optimisons leur structure et leur contenu pour maximiser leur visibilit√©.',
        icon: 'üìÑ',
        detailedInfo: {
          title: 'Optimisation Pages Centrales - En d√©tail',
          content: `Vos pages cl√©s (accueil, services, produits phares) sont les piliers de votre visibilit√©. Chaque page doit cibler un mot-cl√© principal et son champ s√©mantique.

**Ce que nous optimisons :**
‚Ä¢ Balise Title (< 60 caract√®res, mot-cl√© au d√©but)
‚Ä¢ Meta Description (< 160 caract√®res, incitation au clic)
‚Ä¢ Structure H1 / H2 / H3 hi√©rarchique
‚Ä¢ Densit√© et placement des mots-cl√©s
‚Ä¢ Contenu enrichi (listes, tableaux, FAQ)
‚Ä¢ Images (alt text, compression, format WebP)
‚Ä¢ Liens internes contextuels

**Maillage interne :**
Nous cr√©ons une architecture de liens internes coh√©rente pour distribuer le "jus SEO" vers vos pages prioritaires.

**Livrable :** Pages optimis√©es pr√™tes √† publier ou guidelines d√©taill√©es pour votre √©quipe.`
        },
        levels: [
          { name: 'Essentiel', price: 200, features: ['Guidelines d\'optimisation', 'Titres & m√©tas', 'Structure H1/H2'], recommended: 'R√©daction en interne', color: 'blue' },
          { name: 'Avanc√©', price: 400, features: ['Guidelines compl√®tes', 'R√©√©criture des √©l√©ments cl√©s', 'Optimisation des balises'], recommended: 'Cl√© en main partiel', color: 'indigo', popular: true },
          { name: 'Premium', price: 500, features: ['R√©√©criture compl√®te des pages', 'Maillage interne optimis√©', 'Strat√©gie de contenu'], recommended: 'Refonte compl√®te', color: 'purple' }
        ]
      },
      {
        id: 'contenu',
        title: 'D. Contenu IA Optimis√©',
        description: 'Le contenu r√©gulier et de qualit√© est le carburant du SEO. Notre syst√®me IA vous permet de publier des articles optimis√©s.',
        icon: '‚úçÔ∏è',
        detailedInfo: {
          title: 'Contenu IA Optimis√© - En d√©tail',
          content: `La r√©gularit√© est cruciale : 2 articles/semaine = +68% de trafic organique apr√®s 6 mois (source: HubSpot 2024). Google favorise les sites actifs avec du contenu frais.

**Notre Process de Cr√©ation :**
1. Identification des th√©matiques via analyse Ahrefs
2. Analyse des volumes de recherche et difficult√©
3. Structuration optimale (H1, H2, FAQ, tableaux)
4. R√©daction IA personnalis√©e √† votre ton
5. Publication (draft ou directe selon formule)

**Ce qui nous diff√©rencie :**
‚Ä¢ Prompts personnalis√©s + relecture humaine
‚Ä¢ Densit√© naturelle de mots-cl√©s (1-2% max)
‚Ä¢ Minimum 1500 mots avec valeur ajout√©e
‚Ä¢ Monitoring performances + optimisations

**Technologies utilis√©es :**
API Ahrefs, Claude Sonnet 4 / GPT-5, N8N automation, WordPress REST API

**ROI attendu (base 2 articles/semaine) :**
‚Ä¢ Mois 1-2 : +50-100 visiteurs/mois
‚Ä¢ Mois 3-4 : +200-400 visiteurs/mois
‚Ä¢ Mois 5-6 : +500-1000 visiteurs/mois`
        },
        levels: [
          { name: 'Essentiel', price: 350, features: ['2 articles/mois', 'Livr√©s en document', 'Optimis√©s SEO'], recommended: 'D√©marrage ou budget limit√©', color: 'blue' },
          { name: 'Avanc√©', price: 500, features: ['4 articles/mois', 'Push WordPress brouillon', 'Recherche mots-cl√©s incluse'], recommended: 'Croissance r√©guli√®re', color: 'indigo', popular: true },
          { name: 'Premium', price: 650, features: ['8 articles/mois', 'Publication directe', 'Optimisation continue'], recommended: 'Dominer votre secteur', color: 'purple' }
        ]
      },
      {
        id: 'suivi',
        title: 'E. Suivi & Collaboration',
        description: 'Un accompagnement adapt√© √† vos besoins, du simple reporting mensuel √† un suivi rapproch√© avec r√©unions r√©guli√®res.',
        icon: 'ü§ù',
        detailedInfo: {
          title: 'Suivi & Collaboration - En d√©tail',
          content: `Un accompagnement SEO efficace n√©cessite un suivi r√©gulier et une communication claire.

**Ce que comprend le reporting :**
‚Ä¢ √âvolution du trafic organique
‚Ä¢ Positions des mots-cl√©s cibles
‚Ä¢ Nouveaux backlinks acquis
‚Ä¢ Erreurs techniques d√©tect√©es
‚Ä¢ Actions r√©alis√©es le mois pr√©c√©dent
‚Ä¢ Recommandations pour le mois suivant

**Format des meetings :**
‚Ä¢ Pr√©sentation des r√©sultats
‚Ä¢ Discussion des priorit√©s
‚Ä¢ Questions/r√©ponses
‚Ä¢ D√©finition des prochaines actions

**Outils de collaboration :**
‚Ä¢ Dashboard Looker Studio (optionnel)
‚Ä¢ Espace partag√© pour les livrables
‚Ä¢ Support email pour les questions urgentes

**Notre engagement :** Transparence totale sur les actions r√©alis√©es et les r√©sultats obtenus.`
        },
        levels: [
          { name: 'Essentiel', price: 100, features: ['Reporting email mensuel', 'M√©triques cl√©s'], recommended: 'Autonome, peu de questions', color: 'blue' },
          { name: 'Avanc√©', price: 200, features: ['1 meeting/mois', 'R√©cap + brief mensuel', 'Support email'], recommended: '√âchanges r√©guliers', color: 'indigo', popular: true },
          { name: 'Premium', price: 300, features: ['2 meetings/mois', 'Disponibilit√© email r√©active', 'Accompagnement strat√©gique'], recommended: 'Collaboration intensive', color: 'purple' }
        ]
      }
    ];

    const setupOptions = [
      { id: 'tracking', name: 'Tracking & Measurement Setup', description: 'GA4, GTM, conversions, Meta Pixel, Cookie Banner', price: 750 },
      { id: 'dashboard', name: 'Dashboard Looker Studio', description: 'Reporting visuel en temps r√©el', price: 500 }
    ];

    // Composant carte de niveau
    function LevelCard({ level, isSelected, onSelect, disabled }) {
      const colorStyles = {
        blue: { border: isSelected ? 'border-blue-500 ring-2 ring-blue-500 bg-blue-50' : 'border-blue-200 hover:border-blue-400', badge: 'bg-blue-100 text-blue-700' },
        indigo: { border: isSelected ? 'border-indigo-500 ring-2 ring-indigo-500 bg-indigo-50' : 'border-indigo-200 hover:border-indigo-400', badge: 'bg-indigo-100 text-indigo-700' },
        purple: { border: isSelected ? 'border-purple-500 ring-2 ring-purple-500 bg-purple-50' : 'border-purple-200 hover:border-purple-400', badge: 'bg-purple-100 text-purple-700' }
      };

      const styles = colorStyles[level.color];

      return (
        <div onClick={disabled ? undefined : onSelect} className={`level-card relative p-5 rounded-xl border-2 transition-all duration-200 ${disabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'} ${styles.border}`}>
          {level.popular && !disabled && (
            <span className="absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-gradient-to-r from-indigo-500 to-purple-500 text-white text-xs font-semibold rounded-full whitespace-nowrap">
              Populaire
            </span>
          )}
          
          <div className="flex items-center justify-between mb-3">
            <h4 className="font-semibold text-gray-900">{level.name}</h4>
            {isSelected && !disabled && (
              <div className={`w-6 h-6 rounded-full flex items-center justify-center ${styles.badge}`}>
                <CheckIcon />
              </div>
            )}
          </div>
          
          <div className="mb-4">
            <span className="text-2xl font-bold text-gray-900">{level.priceNote || `${level.price}‚Ç¨`}</span>
            <span className="text-gray-500 text-sm">/mois</span>
          </div>
          
          <ul className="space-y-2 mb-4">
            {level.features.map((feature, idx) => (
              <li key={idx} className="flex items-start gap-2 text-sm text-gray-600">
                <span className="text-green-500 mt-0.5 flex-shrink-0"><CheckIcon /></span>
                {feature}
              </li>
            ))}
          </ul>
          
          <div className={`text-xs px-3 py-2 rounded-lg ${styles.badge} inline-flex items-center gap-1`}>
            <span className="flex-shrink-0"><InfoIcon /></span>
            <span>{level.recommended}</span>
          </div>
        </div>
      );
    }

    // Composant section service avec "Non merci" et "En savoir plus"
    function ServiceSection({ service, selection, onSelect, onDisable, isDisabled }) {
      const [showDetails, setShowDetails] = useState(false);

      return (
        <div className={`bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6 fade-in ${isDisabled ? 'disabled-section' : ''}`}>
          {/* Header avec titre et bouton Non merci */}
          <div className="flex items-start justify-between mb-3">
            <div className="flex items-center gap-3">
              <span className="text-3xl">{service.icon}</span>
              <h3 className="text-xl font-bold text-gray-900">{service.title}</h3>
            </div>
            
            {/* Bouton Non merci */}
            <button
              onClick={() => onDisable(service.id)}
              className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${
                isDisabled 
                  ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' 
                  : 'bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700'
              }`}
            >
              {isDisabled ? (
                <>
                  <CheckIcon /> R√©activer
                </>
              ) : (
                <>
                  <XIcon /> Non merci
                </>
              )}
            </button>
          </div>
          
          <p className="text-gray-600 mb-4">{service.description}</p>
          
          {/* Bouton En savoir plus - avec fond visible */}
          <button
            onClick={() => setShowDetails(!showDetails)}
            className="mb-4 px-4 py-2 bg-indigo-100 text-indigo-700 text-sm font-medium rounded-lg flex items-center gap-1 hover:bg-indigo-200 transition-colors"
          >
            <span>{showDetails ? 'Masquer les d√©tails' : 'En savoir plus'}</span>
            <span className={`transform transition-transform ${showDetails ? 'rotate-180' : ''}`}>
              <ChevronDownIcon />
            </span>
          </button>
          
          {/* Section d√©tails expandable */}
          {showDetails && (
            <div className="mb-6 p-4 bg-indigo-50 rounded-xl border border-indigo-100 fade-in">
              <h4 className="font-semibold text-indigo-900 mb-3">{service.detailedInfo.title}</h4>
              <div className="text-sm text-indigo-800 whitespace-pre-line leading-relaxed">
                {service.detailedInfo.content}
              </div>
            </div>
          )}
          
          {/* Cartes des niveaux */}
          {!isDisabled && (
            <>
              <div className="grid md:grid-cols-3 gap-4">
                {service.levels.map((level, idx) => (
                  <LevelCard
                    key={idx}
                    level={level}
                    isSelected={selection === idx}
                    onSelect={() => onSelect(service.id, idx)}
                    disabled={isDisabled}
                  />
                ))}
              </div>
              
              {selection === null && (
                <p className="mt-4 text-sm text-gray-400 text-center">
                  Cliquez sur un niveau pour l'ajouter √† votre devis
                </p>
              )}
            </>
          )}
          
          {/* Message quand d√©sactiv√© */}
          {isDisabled && (
            <div className="py-8 text-center">
              <p className="text-gray-500">Ce service n'est pas inclus dans votre devis</p>
              <p className="text-sm text-gray-400 mt-1">Cliquez sur "R√©activer" pour l'ajouter</p>
            </div>
          )}
        </div>
      );
    }

    // Composant principal
    function SEOCalculator() {
      // null = pas s√©lectionn√©, number = niveau s√©lectionn√©
      const [selections, setSelections] = useState({ audit: null, corrections: null, pages: null, contenu: null, suivi: null });
      // Services d√©sactiv√©s via "Non merci"
      const [disabledServices, setDisabledServices] = useState({ audit: false, corrections: false, pages: false, contenu: false, suivi: false });
      const [setupSelections, setSetupSelections] = useState({ tracking: false, dashboard: false });
      const [duration, setDuration] = useState(4);
      const [showResult, setShowResult] = useState(false);
      const [contactInfo, setContactInfo] = useState({ name: '', email: '', company: '' });
      const [formSubmitted, setFormSubmitted] = useState(false);
      const [isSubmitting, setIsSubmitting] = useState(false);

      const handleSelect = (serviceId, levelIdx) => {
        setSelections(prev => ({ ...prev, [serviceId]: prev[serviceId] === levelIdx ? null : levelIdx }));
      };

      const handleDisable = (serviceId) => {
        setDisabledServices(prev => {
          const newDisabled = !prev[serviceId];
          // Si on d√©sactive, on enl√®ve aussi la s√©lection
          if (newDisabled) {
            setSelections(prevSel => ({ ...prevSel, [serviceId]: null }));
          }
          return { ...prev, [serviceId]: newDisabled };
        });
      };

      const toggleSetup = (id) => {
        setSetupSelections(prev => ({ ...prev, [id]: !prev[id] }));
      };

      // Calcul du total (exclut les services d√©sactiv√©s)
      const { monthlyTotal, setupTotal, selectedServices, discount } = useMemo(() => {
        let monthly = 0;
        let setup = 0;
        const selected = [];

        services.forEach(service => {
          const levelIdx = selections[service.id];
          const isDisabled = disabledServices[service.id];
          if (levelIdx !== null && !isDisabled) {
            const level = service.levels[levelIdx];
            monthly += level.price;
            selected.push({ service: service.title, level: level.name, price: level.price, features: level.features });
          }
        });

        setupOptions.forEach(opt => {
          if (setupSelections[opt.id]) setup += opt.price;
        });

        const discountRate = duration === 6 ? 0.05 : 0;
        const discountAmount = monthly * duration * discountRate;

        return { monthlyTotal: monthly, setupTotal: setup, selectedServices: selected, discount: discountAmount };
      }, [selections, setupSelections, duration, disabledServices]);

      const grandTotal = (monthlyTotal * duration) + setupTotal - discount;
      // Prix mensuel r√©el (incluant setup r√©parti sur la dur√©e)
      const effectiveMonthlyPrice = Math.round(grandTotal / duration);
      const hasSelections = Object.values(selections).some((v, i) => v !== null && !disabledServices[Object.keys(selections)[i]]);

      const handleSubmit = async (e) => {
        e.preventDefault();
        
        // Emp√™cher les soumissions multiples
        if (isSubmitting) return;
        setIsSubmitting(true);
        
        // Pr√©parer les donn√©es d√©taill√©es pour le webhook
        const payload = {
          // Infos contact
          name: contactInfo.name,
          email: contactInfo.email,
          company: contactInfo.company || '',
          
          // D√©tails complets des services s√©lectionn√©s
          servicesDetails: selectedServices.map(s => ({
            name: s.service,
            level: s.level,
            price: s.price,
            features: s.features
          })),
          
          // Setup d√©taill√©
          setupDetails: {
            tracking: setupSelections.tracking ? { name: 'Tracking & Measurement Setup', price: 750 } : null,
            dashboard: setupSelections.dashboard ? { name: 'Dashboard Looker Studio', price: 500 } : null,
            total: setupTotal
          },
          
          // R√©cap financier complet
          duration: duration,
          monthlyServicesTotal: monthlyTotal,
          setupTotal: setupTotal,
          discount: discount,
          grandTotal: grandTotal,
          monthlyPrice: effectiveMonthlyPrice
        };

        try {
          // Envoyer vers N8N webhook
          const response = await fetch('https://n8n.mydigipal.com/webhook/calculateur-seo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          
          if (response.ok) {
            setFormSubmitted(true);
          } else {
            alert('Erreur lors de l\'envoi. Veuillez r√©essayer.');
            setIsSubmitting(false);
          }
        } catch (error) {
          console.error('Erreur:', error);
          alert('Erreur de connexion. Veuillez r√©essayer.');
          setIsSubmitting(false);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
          {/* Header */}
          <header className="bg-white border-b border-gray-100 sticky top-0 z-50">
            <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <a href="https://www.mydigipal.com/fr" target="_blank" rel="noopener noreferrer">
                  <img src="https://cdn.prod.website-files.com/64ec8901e801c89308b10a5b/65f06634783f8c20e2918f0d_01_Main%20.svg" alt="MyDigipal" className="h-10 w-auto" />
                </a>
                <div className="border-l border-gray-200 pl-3">
                  <p className="text-sm font-medium text-gray-700">Simulateur de Management SEO</p>
                </div>
              </div>
              
              {hasSelections && (
                <div className="hidden md:flex items-center gap-4">
                  <div className="text-right">
                    <p className="text-sm text-gray-500">Estimation mensuelle</p>
                    <p className="text-xl font-bold text-indigo-600">{effectiveMonthlyPrice}‚Ç¨/mois</p>
                  </div>
                  <button onClick={() => setShowResult(true)} className="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition flex items-center gap-2">
                    Voir le r√©capitulatif <ArrowRightIcon />
                  </button>
                </div>
              )}
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-4 py-8">
            {/* Intro */}
            <section className="text-center mb-12">
              <div className="inline-flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium mb-4">
                <SparklesIcon /> Offre modulaire sur-mesure
              </div>
              <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Composez votre offre SEO</h2>
              <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                S√©lectionnez le niveau adapt√© pour chaque service ou cliquez sur "Non merci" pour les modules qui ne vous int√©ressent pas.
              </p>
            </section>

            {/* Services */}
            {services.map(service => (
              <ServiceSection 
                key={service.id} 
                service={service} 
                selection={selections[service.id]} 
                onSelect={handleSelect}
                onDisable={handleDisable}
                isDisabled={disabledServices[service.id]}
              />
            ))}

            {/* Setup Options */}
            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6 fade-in">
              <div className="flex items-center gap-3 mb-3">
                <span className="text-3xl">‚öôÔ∏è</span>
                <h3 className="text-xl font-bold text-gray-900">Setup One-Off (optionnel)</h3>
              </div>
              <p className="text-gray-600 mb-6">Des prestations ponctuelles pour poser les fondations de votre tracking.</p>
              
              <div className="grid md:grid-cols-2 gap-4">
                {setupOptions.map(opt => (
                  <div key={opt.id} onClick={() => toggleSetup(opt.id)} className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${setupSelections[opt.id] ? 'border-green-500 bg-green-50 ring-2 ring-green-500' : 'border-gray-200 hover:border-gray-300'}`}>
                    <div className="flex items-center justify-between mb-2">
                      <h4 className="font-semibold text-gray-900">{opt.name}</h4>
                      <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${setupSelections[opt.id] ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>
                        {setupSelections[opt.id] && <CheckIcon />}
                      </div>
                    </div>
                    <p className="text-sm text-gray-600 mb-2">{opt.description}</p>
                    <p className="text-lg font-bold text-gray-900">{opt.price}‚Ç¨ <span className="text-sm font-normal text-gray-500">(une fois)</span></p>
                  </div>
                ))}
              </div>
            </div>

            {/* Duration */}
            <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6 fade-in">
              <div className="flex items-center gap-3 mb-3">
                <span className="text-3xl">üìÖ</span>
                <h3 className="text-xl font-bold text-gray-900">Dur√©e d'engagement</h3>
              </div>
              
              <div className="grid md:grid-cols-2 gap-4">
                {[4, 6].map(d => (
                  <div key={d} onClick={() => setDuration(d)} className={`p-4 rounded-xl border-2 cursor-pointer transition-all ${duration === d ? 'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-500' : 'border-gray-200 hover:border-gray-300'}`}>
                    <div className="flex items-center justify-between">
                      <div>
                        <h4 className="font-semibold text-gray-900">{d} mois</h4>
                        <p className="text-sm text-gray-600">{d === 4 ? 'Engagement minimum' : '5% de remise sur la p√©riode'}</p>
                      </div>
                      <div className="flex items-center gap-2">
                        {d === 6 && <span className="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">-5%</span>}
                        {duration === d && <div className="w-6 h-6 rounded-full bg-indigo-500 flex items-center justify-center text-white"><CheckIcon /></div>}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Mobile Summary Bar */}
            {hasSelections && (
              <div className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-40">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm text-gray-500">Total mensuel</p>
                    <p className="text-xl font-bold text-indigo-600">{effectiveMonthlyPrice}‚Ç¨/mois</p>
                  </div>
                  <button onClick={() => setShowResult(true)} className="px-4 py-3 bg-indigo-600 text-white rounded-lg font-medium">
                    Voir le r√©capitulatif
                  </button>
                </div>
              </div>
            )}

            {/* Desktop Summary */}
            {hasSelections && (
              <div className="hidden md:block bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white fade-in">
                <div className="flex items-center justify-between">
                  <div>
                    <h3 className="text-xl font-bold mb-1">Votre estimation</h3>
                    <p className="text-indigo-200">{selectedServices.length} service{selectedServices.length > 1 ? 's' : ''} s√©lectionn√©{selectedServices.length > 1 ? 's' : ''}</p>
                  </div>
                  
                  <div className="text-right">
                    <p className="text-indigo-200 text-sm">Total sur {duration} mois</p>
                    <p className="text-3xl font-bold">
                      {grandTotal.toLocaleString()}‚Ç¨
                      {discount > 0 && <span className="text-sm font-normal text-green-300 ml-2">(-{discount.toLocaleString()}‚Ç¨)</span>}
                    </p>
                    <p className="text-indigo-200">soit {effectiveMonthlyPrice}‚Ç¨/mois</p>
                  </div>
                  
                  <button onClick={() => setShowResult(true)} className="px-6 py-3 bg-white text-indigo-600 rounded-xl font-semibold hover:bg-indigo-50 transition flex items-center gap-2">
                    Voir le d√©tail <ChevronRightIcon />
                  </button>
                </div>
              </div>
            )}
          </main>

          {/* Modal R√©capitulatif */}
          {showResult && (
            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto">
              <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto fade-in">
                <div className="sticky top-0 bg-white border-b border-gray-100 p-6 flex items-center justify-between">
                  <h3 className="text-xl font-bold text-gray-900">Votre devis personnalis√©</h3>
                  <button onClick={() => setShowResult(false)} className="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                </div>
                
                <div className="p-6">
                  {selectedServices.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">Aucun service s√©lectionn√©.</p>
                  ) : (
                    <>
                      {/* Services s√©lectionn√©s */}
                      <div className="space-y-4 mb-6">
                        {selectedServices.map((item, idx) => (
                          <div key={idx} className="p-4 bg-gray-50 rounded-xl">
                            <div className="flex items-center justify-between mb-2">
                              <div>
                                <h4 className="font-semibold text-gray-900">{item.service}</h4>
                                <span className="text-sm text-indigo-600 font-medium">Niveau {item.level}</span>
                              </div>
                              <span className="text-lg font-bold text-gray-900">{item.price}‚Ç¨/mois</span>
                            </div>
                            <ul className="text-sm text-gray-600">
                              {item.features.map((f, i) => (
                                <li key={i} className="flex items-center gap-2">
                                  <span className="text-green-500"><CheckIcon /></span> {f}
                                </li>
                              ))}
                            </ul>
                          </div>
                        ))}
                        
                        {/* Setup */}
                        {(setupSelections.tracking || setupSelections.dashboard) && (
                          <div className="p-4 bg-amber-50 rounded-xl">
                            <h4 className="font-semibold text-gray-900 mb-2">Setup One-Off</h4>
                            {setupSelections.tracking && <div className="flex justify-between text-sm"><span>Tracking & Measurement Setup</span><span className="font-medium">750‚Ç¨</span></div>}
                            {setupSelections.dashboard && <div className="flex justify-between text-sm"><span>Dashboard Looker Studio</span><span className="font-medium">500‚Ç¨</span></div>}
                          </div>
                        )}
                      </div>

                      {/* Total avec prix mensuel selon dur√©e */}
                      <div className="border-t border-gray-200 pt-4 mb-6">
                        <div className="flex justify-between mb-2">
                          <span className="text-gray-600">Dur√©e d'engagement</span>
                          <span className="font-semibold">{duration} mois</span>
                        </div>
                        {setupTotal > 0 && (
                          <div className="flex justify-between mb-2">
                            <span className="text-gray-600">Setup one-off</span>
                            <span className="font-semibold">{setupTotal}‚Ç¨</span>
                          </div>
                        )}
                        {discount > 0 && (
                          <div className="flex justify-between mb-2 text-green-600">
                            <span>Remise engagement 6 mois (-5%)</span>
                            <span className="font-semibold">-{discount.toLocaleString()}‚Ç¨</span>
                          </div>
                        )}
                        <div className="bg-indigo-50 rounded-xl p-4 mt-4">
                          <div className="flex justify-between items-center">
                            <span className="text-lg font-bold text-gray-900">Total</span>
                            <div className="text-right">
                              <span className="text-2xl font-bold text-indigo-600">{grandTotal.toLocaleString()}‚Ç¨</span>
                              <p className="text-sm text-gray-600">soit <span className="font-semibold text-indigo-600">{effectiveMonthlyPrice}‚Ç¨/mois</span></p>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Les + MyDigipal */}
                      <div className="bg-indigo-50 rounded-xl p-4 mb-6">
                        <h4 className="font-semibold text-indigo-900 mb-2 flex items-center gap-2"><SparklesIcon /> Inclus dans tous nos services</h4>
                        <ul className="text-sm text-indigo-800 space-y-1">
                          <li>‚úì Optimisation LLM (ChatGPT, Perplexity, Copilot)</li>
                          <li>‚úì Outils premium (Ahrefs, Search Console)</li>
                          <li>‚úì Approche 100% data-driven</li>
                          <li>‚úì Transparence totale sur les actions</li>
                        </ul>
                      </div>

                      {/* Contact Form */}
                      <div className="border-t border-gray-200 pt-6">
                        {formSubmitted ? (
                          <div className="text-center py-8">
                            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                              <span className="text-green-500 text-2xl">‚úì</span>
                            </div>
                            <h4 className="text-xl font-bold text-gray-900 mb-2">Merci !</h4>
                            <p className="text-gray-600">Nous vous recontacterons sous 24h.</p>
                          </div>
                        ) : (
                          <>
                            <h4 className="font-semibold text-gray-900 mb-4">Recevoir ce devis par email</h4>
                            <form onSubmit={handleSubmit} className="space-y-3">
                              <input type="text" placeholder="Votre nom" value={contactInfo.name} onChange={(e) => setContactInfo(prev => ({ ...prev, name: e.target.value }))} required disabled={isSubmitting} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none disabled:bg-gray-100 disabled:cursor-not-allowed" />
                              <input type="email" placeholder="Votre email" value={contactInfo.email} onChange={(e) => setContactInfo(prev => ({ ...prev, email: e.target.value }))} required disabled={isSubmitting} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none disabled:bg-gray-100 disabled:cursor-not-allowed" />
                              <input type="text" placeholder="Votre entreprise (optionnel)" value={contactInfo.company} onChange={(e) => setContactInfo(prev => ({ ...prev, company: e.target.value }))} disabled={isSubmitting} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none disabled:bg-gray-100 disabled:cursor-not-allowed" />
                              <button type="submit" disabled={isSubmitting} className="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center justify-center gap-2 disabled:bg-indigo-400 disabled:cursor-not-allowed">
                                {isSubmitting ? (
                                  <>
                                    <LoaderIcon /> Envoi en cours...
                                  </>
                                ) : (
                                  <>
                                    <MailIcon /> Envoyer le devis
                                  </>
                                )}
                              </button>
                            </form>
                            <p className="text-xs text-gray-500 mt-3 text-center">Nous vous recontacterons sous 24h.</p>
                          </>
                        )}
                      </div>
                    </>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* Footer */}
          <footer className="bg-white border-t border-gray-100 py-8 mt-12 mb-20 md:mb-0">
            <div className="max-w-6xl mx-auto px-4 text-center">
              <p className="text-gray-600 mb-2">Des questions ?</p>
              <a href="mailto:paul@mydigipal.com" className="text-indigo-600 font-semibold hover:underline">paul@mydigipal.com</a>
              <p className="mt-4">
                <a href="https://www.mydigipal.com/fr" target="_blank" rel="noopener noreferrer" className="text-gray-500 hover:text-indigo-600 text-sm">www.mydigipal.com</a>
              </p>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SEOCalculator />);
  </script>
</body>
</html>
